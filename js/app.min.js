var initialLocations=[{name:"Winter Park Elementary School",address:"204 N MacMillan Ave, Wilmington, NC 28403",latLng:"",category:"Education",tags:["education","school"],link:"http://nhcs.net"},{name:"Hugh MacRae Park",address:"1799 S College Rd, Wilmington, NC 28403",latLng:"",category:"Parks and sports",tags:["recreation","park","playground","baseball","tennis"],link:"http://nhcgov.com"},{name:"Harris Teeter",address:"822 S College Rd, Wilmington, NC 28403",latLng:"",category:"Groceries",tags:["groceries","food","market"],link:"http://locations.harristeeter.com"},{name:"University of North Carolina Wilmington",address:"603 S College Rd, Wilmington, NC 28403",latLng:"",category:"Education",tags:["education","university","studies"],link:"http://uncw.edu"},{name:"Venture Church",address:"2024 Independence Blvd, Wilmington, NC 28403",latLng:"",category:"Church",tags:["church","service","worship"],link:"http://jointheventure.com"},{name:"Wild Wing Cafe",address:"1331 Military Cutoff Rd, Wilmington, NC 28405",latLng:"",category:"Fast Food",tags:["fast food","restaurant","food"],link:"http://wildwingcafe.com"},{name:"Wilmington International Airport",address:"1740 Airport Blvd, Suite 12, Wilmington, NC 28405",latLng:"",category:"Airport",tags:["airport","plane","flight","travel"],link:"http://www.flyilm.com/"}],markerCategories=[{category:"Coffee",icon:{normal:"images/cat-1.png",selected:"images/cat-1s.png"}},{category:"Groceries",icon:{normal:"images/cat-2.png",selected:"images/cat-2s.png"}},{category:"Airport",icon:{normal:"images/cat-3.png",selected:"images/cat-3s.png"}},{category:"Nightlife",icon:{normal:"images/cat-4.png",selected:"images/cat-4s.png"}},{category:"Transportation",icon:{normal:"images/cat-5.png",selected:"images/cat-5s.png"}},{category:"Fast Food",icon:{normal:"images/cat-6.png",selected:"images/cat-6s.png"}},{category:"Church",icon:{normal:"images/cat-7.png",selected:"images/cat-7s.png"}},{category:"Education",icon:{normal:"images/cat-8.png",selected:"images/cat-8s.png"}},{category:"Parks and sports",icon:{normal:"images/cat-9.png",selected:"images/cat-9s.png"}}],geocode=function(){initialLocations.forEach(function(e){var a=e.address.replace(" ","+"),t="AIzaSyA2FFND0yTl6LbApiZxjut09JyBxcBe_Jo",n="https://maps.googleapis.com/maps/api/geocode/json?address="+a+"&key="+t;$.getJSON(n,function(a){"OK"==a.status?e.latLng=a.results[0].geometry.location:alert("Geocode was not successful for the following reason: "+status)})})};geocode();var addMarker=function(e,a){var t=new google.maps.Marker({position:e.latLng,map:map,title:e.name,animation:google.maps.Animation.DROP,icon:a.normal}),n=new google.maps.InfoWindow({content:""});return n.addListener("closeclick",function(){closeCurrentMarker()}),t.metadata={tags:e.tags,icon:a,infowindow:n},t.addListener("click",function(){openMarker(t)}),editInfowindow(t,e),t},editInfowindow=function(e,a){var t="https://en.wikipedia.org/w/api.php?action=opensearch&search="+a.name+"&format=json&callback=wikiCallBack",n="";$.ajax({url:t,dataType:"jsonp",success:function(t){var o,r=t[1];0===r.length&&(n="no resources found");for(var i=0;i<r.length;i++){o=r[i];var s="http://en.wikipedia.org/wiki/"+o;n+='<li><a href="'+s+'">'+o+"</a></li>"}var c="https://maps.googleapis.com/maps/api/streetview?size=150x100&location="+a.address,l='<div class="scrollFix"><h3>'+a.name+"</h3><p>"+a.address+'<br>Website : <a href="'+a.link+'">'+a.link+'</a></p><img src="'+c+'" alt="streetview image" class="img-thumbnail img-responsive"><div><h4>Wikipedia articles</h4><ul>'+n+"</ul></div></div>";e.metadata.infowindow.setContent(l)}})},openMarker=function(e){closeCurrentMarker(),e.metadata.infowindow.open(map,e),e.setIcon(e.metadata.icon.selected),currentMarker=e},closeCurrentMarker=function(){null!==currentMarker&&(currentMarker.metadata.infowindow.close(),currentMarker.setIcon(currentMarker.metadata.icon.normal))},ViewModel=function(){var e=this;this.markerList=ko.observableArray([]),initialLocations.forEach(function(a){var t;markerCategories.forEach(function(e){a.category==e.category&&(t=e.icon)}),e.markerList.push(addMarker(a,t))}),this.searchStr=ko.observable(""),this.currentMarkers=ko.computed(function(){var e,a=this.markerList(),t=this.searchStr().toLowerCase(),n=[];return closeCurrentMarker(),""!==t&&($("#dropdown-menu").attr("aria-expanded",!0),$("#dropdown-list").addClass("open")),a.forEach(function(a){e=!1,a.setVisible(!0),""===t||-1!=a.title.toLowerCase().search(t)?e=!0:a.metadata.tags.forEach(function(a){-1!=a.toLowerCase().search(t)&&(e=!0)}),e?n.push(a):a.setVisible(!1)}),n},this),this.showResults=function(){$("#mobile-button").click();var a=e.currentMarkers()[0];openMarker(a)},this.selectMarker=function(){$("#mobile-button").click();var e=this;openMarker(e)}},map,currentMarker=null,initMap=function(){var e={center:{lat:34.2057255,lng:-77.8900102},zoom:12};map=new google.maps.Map(document.getElementById("map"),e),google.maps.event.addListenerOnce(map,"idle",function(){ko.applyBindings(new ViewModel)})};$(document).ready(function(){$("[data-toggle=offcanvas]").click(function(){$(".row-offcanvas").toggleClass("active")})});